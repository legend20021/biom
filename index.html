<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- Prevenir renderizado antes de que los estilos est√©n listos -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>BIOMASTER Pro V2 IA</title>

  <!-- Preload de recursos cr√≠ticos -->
  <link rel="preload" href="./css/clean.css" as="style"
    onload="this.onload=null;this.rel='stylesheet';document.documentElement.classList.add('styles-loaded')">
  <noscript>
    <link rel="stylesheet" href="./css/clean.css">
  </noscript>

  <style>
    /* Variables CSS cr√≠ticas para tema claro y oscuro */
    :root {
      --background-color: #f8fafc;
      --bg-secondary: #f1f5f9;
      --primary-color: #2563eb;
      --secondary-color: #3b82f6;
      --text-primary: #1e293b;
      --card-shadow: 0 4px 6px rgb(0 0 0 / 15%), 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    :root[data-theme="dark"] {
      --background-color: #0f172a;
      --bg-secondary: #374151;
      --primary-color: #3b82f6;
      --secondary-color: #60a5fa;
      --text-primary: #f1f5f9;
      --card-shadow: 0 4px 6px rgb(0 0 0 / 25%), 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* Estilos cr√≠ticos para evitar FOUC */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--background-color);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-in-out;
      font-display: swap;
    }

    /* Mostrar contenido cuando los estilos est√©n listos */
    html.styles-loaded body,
    body.loaded {
      opacity: 1;
      visibility: visible;
    }

    /* Fallback temporal para JavaScript deshabilitado */
    html:not(.styles-loaded) body {
      animation: fouc-fallback 0.1s ease-in-out 2s forwards;
    }

    @keyframes fouc-fallback {
      to {
        opacity: 1;
        visibility: visible;
      }
    }

    body.loading {
      overflow: hidden;
    }

    /* Loader inicial - estilos cr√≠ticos que coinciden con el dise√±o principal */
    .initial-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--background-color) 0%, var(--bg-secondary) 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000000;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .initial-loader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader-container {
      text-align: center;
      transform: scale(0.9);
      animation: loaderEntry 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    .company-logo {
      margin-bottom: 1rem;
      animation: logoFloat 3s ease-in-out infinite;
    }

    .logo-circle {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
      background-position: center;
      background-size: contain;
      background-image: url('./icons/pyh.png');
    }

    .loader-text {
      color: var(--text-primary);
      text-align: center;
      animation: textFadeIn 1s ease-out 0.5s both;
      display: grid;
      place-items: center;
    }

    .loader-text h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .loader-spinner-modern {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .spinner-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 3px solid transparent;
    }

    .spinner-ring:nth-child(1) {
      border-top-color: var(--primary-color);
      animation: spinRing 1.5s linear infinite;
    }

    .spinner-ring:nth-child(2) {
      border-right-color: var(--secondary-color);
      animation: spinRing 1.5s linear infinite reverse;
      animation-delay: 0.2s;
    }

    .spinner-ring:nth-child(3) {
      border-bottom-color: var(--primary-color);
      animation: spinRing 1.5s linear infinite;
      animation-delay: 0.4s;
    }

    .main-container {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    body:not(.loading) .main-container {
      opacity: 1;
    }

    /* Animaciones cr√≠ticas */
    @keyframes loaderEntry {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(20px);
      }

      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    @keyframes logoFloat {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-8px);
      }
    }

    @keyframes spinRing {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes textFadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>

  <!-- Preload de iconos cr√≠ticos -->
  <link rel="preload" href="./icons/pyh.png" as="image">
  <link rel="preload" href="./icons/menu.svg" as="image">
  <link rel="preload" href="./icons/config-white.svg" as="image">

  <!-- Eliminamos el link normal del CSS ya que se carga con preload -->
  <link rel="icon" type="image/x-icon" href="" />
  <link rel="icon" type="image/png" href="./icons/pyh.png" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">

  <!-- Meta tags adicionales para PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="BIOMASTER">
  <link rel="apple-touch-icon" href="./icons/pyh.png">

  <!-- Meta tags para SEO y performance -->
  <meta name="description" content="Sistema de control avanzado para biofermentaci√≥n - BIOMASTER Pro V2 IA">
  <meta name="keywords" content="biofermentaci√≥n, control, sensores, IoT, agricultura">
  <meta name="author" content="Penagos y Hermanos">
  <meta name="robots" content="index, follow">
</head>

<body class="loading">

  <!-- Script inline para manejo de FOUC -->
  <script>
    // Prevenir FOUC y manejar carga de estilos
    (function () {
      let stylesLoaded = false;
      let domReady = false;

      // Funci√≥n para mostrar el contenido cuando todo est√© listo
      function showContent() {
        if (stylesLoaded && domReady) {
          document.body.classList.add('loaded');
          // Peque√±o delay adicional para asegurar que todo est√© renderizado
          requestAnimationFrame(() => {
            document.body.style.visibility = 'visible';
          });
        }
      }

      // Detectar cuando los estilos est√©n cargados
      function checkStylesLoaded() {
        if (document.documentElement.classList.contains('styles-loaded')) {
          stylesLoaded = true;
          showContent();
        }
      }

      // Detectar cuando el DOM est√© listo
      function handleDOMReady() {
        domReady = true;
        showContent();
      }

      // Verificar estilos peri√≥dicamente
      const styleCheck = setInterval(() => {
        checkStylesLoaded();
        if (stylesLoaded) {
          clearInterval(styleCheck);
        }
      }, 50);

      // Si los estilos ya est√°n cargados
      if (document.readyState !== 'loading') {
        handleDOMReady();
        checkStylesLoaded();
      } else {
        // Esperar a que el DOM est√© listo
        document.addEventListener('DOMContentLoaded', handleDOMReady);
      }

      // Fallback: forzar carga despu√©s de tiempo l√≠mite
      setTimeout(() => {
        if (!stylesLoaded) {
          console.warn('BIOMASTER: Timeout en carga de estilos, mostrando contenido');
          stylesLoaded = true;
          showContent();
        }
        clearInterval(styleCheck);
      }, 3000);

      // Fallback m√°s agresivo para casos extremos
      setTimeout(() => {
        document.body.classList.add('loaded');
        document.body.style.opacity = '1';
        document.body.style.visibility = 'visible';
      }, 5000);
    })();
  </script>

  <!-- Loader inicial -->
  <div class="initial-loader">
    <div class="loader-container">
      <div class="company-logo">
        <div class="logo-circle">
          <div class="logo-inner">
            <span class="logo-letter"></span>
          </div>
        </div>
      </div>
      <div class="loader-content">

        <div class="loader-text">
          <h3>BIOMASTER Pro V2 IA</h3>
          <p>Inicializando componentes del sistema...</p>
          <div class="loader-spinner-modern">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-container">


    <!-- Barra de progreso horizontal para procesos en ejecuci√≥n -->
    <div class="progress-bar-container" id="progressBarContainer">
      <div class="progress-bar-fill" id="progressBarFill"></div>
    </div>

    <!-- Bot√≥n de men√∫, visible solo en dispositivos peque√±os -->
    <div class="menu-button" id="menuButton" onclick="toggleMenu()">
      <img class="custom-icon" src="./icons/menu.svg" alt="Men√∫" loading="eager">
    </div>

    <div class="menu-button scroll-top" id="scrollTop" onclick="scrollToTop()">
      <img class="custom-icon" src="./icons/up.svg" alt="Men√∫" loading="eager">
    </div>

    <div class="control-button" id="controlButton" onclick="toggleActionButtons()">
      <img class="custom-icon" src="./icons/config-white.svg" alt="Configuraci√≥n" loading="eager">
    </div>
    <div class="control-button play-button" id="playButton" onclick="actionPlay()">
      <img class="custom-icon" src="./icons/play.svg" alt="Men√∫" loading="eager">
    </div>
    <div class="control-button stop-button" id="stopButton" onclick="actionStop()">
      <img class="custom-icon" src="./icons/stop.svg" alt="Men√∫" loading="eager">
    </div>
    <div class="control-button close-button" id="closeButton" onclick="actionClose()">
      <img class="custom-icon" src="./icons/close.svg" alt="Men√∫" loading="eager">
    </div>


    <div class="sidebar" id="sidebar">
      <!-- Logo y branding -->
      <div class="logo-section">
        <img src="./icons/pyh.png" alt="Penagos y Hermanos Logo" loading="eager">
        <div class="company-name">PENAGOS Y HERMANOS</div>
        <div class="machine-name">Biomaster Pro V2 IA</div>
      </div>

      <!-- Navegaci√≥n principal -->
      <nav>
        <ul class="nav-menu">
          <li class="nav-item fade-in-up">
            <a href="#dashboard" class="nav-link active" data-section="dashboard" onclick="showSection(event)">
              <span class="nav-icon">
                <img class="custom-icon" src="./icons/dashboard.svg" alt="Dashboard" loading="lazy">
              </span>
              Dashboard
            </a>
          </li>
          <li class="nav-item fade-in-up">
            <a href="#graficas" class="nav-link" data-section="graficas" onclick="showSection(event)">
              <span class="nav-icon">
                <img class="custom-icon" src="./icons/graph.svg" alt="Gr√°ficas" loading="lazy">
              </span>
              Gr√°ficas
            </a>
          </li>
          <li class="nav-item fade-in-up">
            <a href="#usuarios" class="nav-link" data-section="usuarios" onclick="showSection(event)">
              <span class="nav-icon">
                <img class="custom-icon" src="./icons/users.svg" alt="Usuarios" loading="lazy">
              </span>
              Usuarios
            </a>
          </li>
          <li class="nav-item fade-in-up">
            <a href="#conexiones" class="nav-link" data-section="conexiones" onclick="showSection(event)">
              <span class="nav-icon">
                <img class="custom-icon" src="./icons/wifi.svg" alt="WiFi" loading="lazy">
              </span>
              Conexiones
            </a>
          </li>
          <li class="nav-item fade-in-up">
            <a href="#ayuda" class="nav-link" data-section="ayuda" onclick="showSection(event)">
              <span class="nav-icon">
                <img class="custom-icon" src="./icons/help.svg" alt="Ayuda" loading="lazy">
              </span>
              Ayuda
            </a>
          </li>
        </ul>
      </nav>

      <!-- Bot√≥n de cambio de tema -->
      <div class="theme-toggle-container">
        <button class="theme-toggle-btn" id="themeToggle" onclick="toggleTheme()">
          <span class="theme-icon" id="themeIcon">üåô</span>
          <span class="theme-text" id="themeText">Tema Oscuro</span>
        </button>
      </div>

      <!-- Bot√≥n de modo demo -->
      <div class="demo-toggle-container">
        <button class="demo-toggle-btn" id="demoToggle" onclick="toggleDemoMode()">
          <span class="demo-icon" id="demoIcon">üß™</span>
          <span class="demo-text" id="demoText">Modo Demo</span>
        </button>
      </div>
      <!-- Dos botones en columna, uno para simular un start y otro para simular un stop -->
      <div class="action-buttons-container" id="actionButtonsContainer">
        <button class="action-button" id="startButton" onclick="simulateStart()">
          <span class="action-icon">‚ñ∂Ô∏é</span>
          <span class="action-text">Iniciar Proceso</span>
        </button>
        <button class="action-button" id="stopButton" onclick="simulateStop()">
          <span class="action-icon">‚èπ</span>
          <span class="action-text">Detener Proceso</span>
        </button>
      </div>
    </div>

    <!-- Overlay para cerrar sidebar en m√≥viles -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Contenido principal -->

    <div class="main-content">

      <div class="content" id="dashboard" style="display: block">
        <div class="demo-indicator" id="demoIndicator" style="display: none;">
          <span class="demo-text">Modo Demo Activado</span>
        </div>
        
        <!-- Header principal del dashboard -->
        <header class="dashboard-header">
          <div class="header-content">
            <div class="header-main">
              <h1 class="dashboard-title">Panel de Control</h1>
              <p class="dashboard-subtitle">Sistema de Monitoreo BIOMASTER Pro V2 IA</p>
            </div>
          </div>
        </header>


        <div class="indicators">

          <div class="indicator-card" id="TimePanel">
            <div class="indicator-title help-icon position-relative" title="Calibra la presi√≥n del sistema">
              Tiempo de proceso
            </div>
            <span class="status-ready">
              <span id="timer-hours">00</span> hrs
              <span class="timer-separator">:</span>
              <span id="timer-minutes">00</span> <span>min</span>
            </span>
            <div class="system-status">
              <div class="status-item">
                <span>Proceso:</span>
                <span id="processTextStatus" class="mode-display">Detenido</span>
              </div>
            </div>
          </div>

          <div class="indicator-card">
            <div class="system-status">
              <div class="status-item">
                <span>Conexi√≥n:</span>
                <span class="connection-text">Offline</span>
              </div>
              <div class="status-item">
                <span>Usuarios conectados:</span>
                <span class="conected-users">0</span>
              </div>
              <div class="status-item">
                <span>T. Controlador:</span>
                <span id="temp_sp">0 ¬∞C</span>
              </div>
            </div>
          </div>


          <div class="indicator-card">
            <span class="open-calibration" onclick="toggleCalibration('pressure-calibration')">
              <img class="custom-icon" src="./icons/config.svg" alt="Configurar presi√≥n" loading="lazy">
            </span>
            <div class="indicator-title help-icon position-relative" title="Calibra la presi√≥n del sistema">
              Presi√≥n del Sistema
            </div>
            <div class="progress-container">
              <div class="progress-bar" id="pressureProgress"></div>
            </div>
            <div class="indicator-data">
              <span class="current-value" id="pressureValue">0 PSI</span>
              <span class="setpoint"><span id="pressureSetpoint">0 PSI</span></span>
            </div>
            <div id="pressure-calibration" class="hideCalibration w-100">
              <button class="btn" id="calibrate-pressure">
                <i class="fas fa-sync-alt"></i> Calibrar
              </button>
              <div class="progress-container-back">
                <div class="progress-bar-back">
                  <div class="progress-back" id="pressure-progress"></div>
                </div>
              </div>
            </div>
          </div>


          <div class="indicator-card">
            <span class="open-calibration" onclick="toggleCalibration('ph-calibration')">
              <img class="custom-icon" src="./icons/config.svg" alt="Configurar pH" loading="lazy">
            </span>
            <div class="indicator-title help-icon position-relative" title="Calibra el Ph del sistema">pH Lixiviados
            </div>
            <div class="progress-container">
              <div class="progress-bar" id="phProgress"></div>
            </div>
            <div class="indicator-data">
              <span class="current-value" id="phValue">0.0</span>
              <span class="setpoint"><span>Escala: 0-14</span></span>
            </div>

            <div id="ph-calibration" class="hideCalibration w-100">
              <div class="ph-buttons">
                <button id="ph4-btn" class="btn" onclick="calibratePH(4)">pH 4</button>
                <button id="ph7-btn" class="btn" onclick="calibratePH(7)">pH 7</button>
                <button id="ph10-btn" class="btn" onclick="calibratePH(10)">pH 10</button>
              </div>
              <div class="progress-container-back">
                <div class="progress-bar-back">
                  <div class="progress-back" id="ph-progress"></div>
                </div>
              </div>
            </div>
          </div>


          <!-- Tarjeta: Temperatura del Lixiviado -->
          <div class="indicator-card">
            <span class="open-calibration" onclick="toggleCalibration('temp-m-calibration')">
              <img class="custom-icon" src="./icons/config.svg" alt="Configurar temperatura masa" loading="lazy">
            </span>
            <div class="indicator-title help-icon position-relative" title="Calibra la temperatura de masa">Temperatura
              de Masa</div>
            <div class="progress-container">
              <div class="progress-bar" id="tempProgress"></div>
            </div>
            <div class="indicator-data">
              <span class="current-value" id="tempValue">0.0¬∞C</span>
              <!-- <span class="setpoint"><span id="tempSetpoint">28.0¬∞C</span></span> -->
            </div>

            <div id="temp-m-calibration" class="temp-control-group hideCalibration w-100">
              <div class="input-control">
                <input type="number" id="masa-temp-input" min="0" max="100" step="0.1"
                  placeholder="Ingrese la temperatura" />
                <button class="btn" onclick="calibrateMasaTemp()">
                  <i class="fas fa-sync-alt"></i> Calibrar
                </button>
              </div>
            </div>

          </div>


          <!-- Tarjeta: Temperatura del Lixiviado -->
          <div class="indicator-card">
            <span class="open-calibration" onclick="toggleCalibration('temp-l-calibration')">
              <img class="custom-icon" src="./icons/config.svg" alt="Configurar temperatura lixiviado" loading="lazy">
            </span>
            <div class="indicator-title help-icon position-relative" title="Calibra la temperatura de lixiviado">
              Temperatura de Lixiviado</div>
            <div class="progress-container">
              <div class="progress-bar" id="tempLixProgress"></div>
            </div>
            <div class="indicator-data">
              <span class="current-value" id="tempLixValue">0.0¬∞C</span>
              <span class="setpoint"><span id="tempLixSetpoint">28.0¬∞C</span></span>
            </div>

            <div id="temp-l-calibration" class="temp-control-group hideCalibration w-100">
              <div class="input-control">
                <input type="number" id="lix-temp-input" min="0" max="100" step="0.1"
                  placeholder="Ingrese la temperatura" />
                <button class="btn" onclick="calibrateLixTemp()">
                  <i class="fas fa-sync-alt"></i> Calibrar
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="control-variables-container">

          <div class="control-cards" id="controlCards">
            <div class="control-cards-container">
              <div>
                <!-- Recirculaci√≥n -->
                <div class="card">
                  <div class="card-header">
                    <div class="card-text">
                      <h4>Recirculaci√≥n</h4>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="recirculationToggle" />
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>

                <!-- Control de Temperatura -->
                <div class="card">
                  <div class="card-header">
                    <div class="card-text">
                      <h4>Temperatura</h4>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="temperatureBtn" />
                      <span class="slider"></span>
                    </label>
                  </div>
                  <div class="input-group1" id="temperatureInput">
                    <input type="number" placeholder="Temperatura (0-100)" min="0" max="100" />
                    <button class="send-btn btn">Enviar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="control-cards" id="controlCards">
            <div class="control-cards-container">
              <div>
                <div class="control-group">
                  <div class="control-header">
                    <div class="card-text">
                      <h4>Presi√≥n Natural</h4>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="naturalPressureBtn" />
                      <span class="slider"></span>
                    </label>
                  </div>
                  <div class="input-group1" id="naturalPressureInput">
                    <input type="number" placeholder="PSI (0-10)" min="0" max="10" />
                    <button class="send-btn btn">Enviar</button>
                  </div>
                </div>

                <div class="control-group">
                  <div class="control-header">
                    <div class="card-text">
                      <h4>Maceraci√≥n Carb√≥nica</h4>
                    </div>
                    <label class="switch">
                      <input type="checkbox" id="carbonicMacerationBtn" />
                      <span class="slider"></span>
                    </label>
                  </div>
                  <div class="input-group1" id="carbonicMacerationInput">
                    <input type="number" placeholder="PSI (0-10)" min="0" max="10" />
                    <button class="send-btn btn">Enviar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>


      </div>

      <!-- FIN DASHBOARD PRINCIPAL---------------------------------------------------------- -->

      <!--  DASHBOARD PRINCIPAL Graficas---------------------------------------------------------- -->

      <div class="content" id="graficas" style="display: none">
        <div class="header-info">
          <button class="connection-btn-fixed online">
            <span>üîò</span> <span class="pressureValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è M</span> <span class="tempValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è L</span> <span class="tempLixValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üíß</span> <span class="phValue">0</span>
          </button>
        </div>

        <div class="chart-page">
          <!-- Contenedor principal de la gr√°fica -->
          <div class="chart-container">
            <canvas id="multiAxisChart"></canvas>
          </div>

          <!-- Paneles de control organizados -->
          <div class="panel-container">
            <!-- Panel de Filtros Temporales -->
            <div class="panel time-filter-panel">
              <h3>Filtros de datos</h3>

              <!-- Filtros R√°pidos -->
              <div class="control-section">

                <p class="control-description">Acceso r√°pido a per√≠odos comunes</p>
                <div class="quick-filters">
                  <button class="btn filter-btn" data-filter="6" onclick="filtrarPuntos(6)"
                    title="Mostrar solo la √∫ltima hora de datos">
                    <span class="btn-icon">‚è∞</span>
                    <span class="btn-text">√öltima Hora</span>
                  </button>
                  <button class="btn filter-btn" data-filter="18" onclick="filtrarPuntos(18)"
                    title="Mostrar las √∫ltimas 3 horas de datos">
                    <span class="btn-icon">üïê</span>
                    <span class="btn-text">√öltimas 3h</span>
                  </button>
                  <button class="btn filter-btn" data-filter="36" onclick="filtrarPuntos(36)"
                    title="Mostrar las √∫ltimas 6 horas de datos">
                    <span class="btn-icon">üïï</span>
                    <span class="btn-text">√öltimas 6h</span>
                  </button>
                  <button class="btn filter-btn" data-filter="72" onclick="filtrarPuntos(72)"
                    title="Mostrar las √∫ltimas 12 horas de datos">
                    <span class="btn-icon">üïò</span>
                    <span class="btn-text">√öltimas 12h</span>
                  </button>
                </div>
              </div>

              <!-- Filtro Personalizado -->
              <div class="control-section">

                <p class="control-description">Define un per√≠odo espec√≠fico de visualizaci√≥n</p>
                <div class="custom-filter">
                  <div class="input-group">
                    <label for="horasInput">√öltimas horas a mostrar:</label>
                    <div class="input-with-button">
                      <input id="horasInput" type="number" min="1" max="100" placeholder="Ej: 8"
                        title="Introduce el n√∫mero de horas a mostrar" />
                      <button class="btn action-btn" onclick="filtrarPorHoras()"
                        title="Aplicar el filtro personalizado">
                        <span class="btn-icon">üîç</span>
                        <span class="btn-text">Filtrar</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <!-- Panel de Configuraci√≥n de Visualizaci√≥n -->
            <div class="panel chart-config-panel">
              <h3>Configuraci√≥n de Visualizaci√≥n</h3>

              <!-- Secci√≥n de Granularidad -->
              <div class="control-section">

                <p class="control-description">Selecciona la resoluci√≥n temporal de los datos mostrados</p>
                <div class="granularity-controls">
                  <button class="btn granularity-btn active" data-granularity="1" onclick="setGranularity(1)"
                    title="Mostrar un punto cada 10 minutos">
                    <span class="btn-icon">‚è∞</span>
                    <span class="btn-text">10 min</span>
                  </button>
                  <button class="btn granularity-btn" data-granularity="3" onclick="setGranularity(3)"
                    title="Mostrar un punto cada 30 minutos">
                    <span class="btn-icon">‚è±Ô∏è</span>
                    <span class="btn-text">30 min</span>
                  </button>
                  <button class="btn granularity-btn" data-granularity="6" onclick="setGranularity(6)"
                    title="Mostrar un punto cada hora">
                    <span class="btn-icon">üïê</span>
                    <span class="btn-text">1 hora</span>
                  </button>
                  <button class="btn granularity-btn" data-granularity="12" onclick="setGranularity(12)"
                    title="Mostrar un punto cada 2 horas">
                    <span class="btn-icon">üïì</span>
                    <span class="btn-text">2 horas</span>
                  </button>
                  <button class="btn granularity-btn" data-granularity="18" onclick="setGranularity(18)"
                    title="Mostrar un punto cada 3 horas">
                    <span class="btn-icon">üïï</span>
                    <span class="btn-text">3 horas</span>
                  </button>
                </div>
              </div>

              <!-- Secci√≥n de Zoom y Navegaci√≥n -->
              <div class="control-section">

                <p class="control-description">Herramientas para explorar los datos</p>
                <div class="zoom-controls">
                  <button class="btn control-btn" onclick="resetZoom()" title="Restablecer el zoom a la vista completa">
                    <span class="btn-icon">üîç</span>
                    <span class="btn-text">Resetear Zoom</span>
                  </button>
                  <button class="btn control-btn primary" onclick="restaurarDatos()"
                    title="Mostrar todos los datos disponibles">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">Ver Todo</span>
                  </button>
                </div>
              </div>

              <div class="control-section">

                <p class="control-description">Descarga los datos visibles en diferentes formatos</p>
                <div class="export-controls">
                  <button class="btn export-btn" onclick="descargarGrafica()"
                    title="Descargar la gr√°fica como imagen JPG de alta calidad">
                    <span class="btn-icon">üìà</span>
                    <span class="btn-text">Imagen JPG</span>
                  </button>
                  <button class="btn export-btn" onclick="descargarCSV()"
                    title="Descargar los datos como archivo CSV para an√°lisis">
                    <span class="btn-icon">üìã</span>
                    <span class="btn-text">Datos CSV</span>
                  </button>
                </div>
              </div>
            </div>


          </div>
        </div>
      </div>

      <div class="content" id="usuarios" style="display: none">
        <!-- contenido del telegram -->
        <div class="header-info">
          <button class="connection-btn-fixed online">
            <span>üîò</span> <span class="pressureValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è M</span> <span class="tempValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è L</span> <span class="tempLixValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üíß</span> <span class="phValue">0</span>
          </button>
        </div>


        <h2>Registro de usuarios</h2>

        <div class="panel user-table">
          <table id="userTable">
            <thead>
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Nombre</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="panel">
          <div class="container2">
            <input type="number" id="userId" placeholder="ID del Usuario" required />
            <input type="text" id="userName" placeholder="Nombre del Usuario" required />
          </div>
          <div class="container2">
            <button class="btn" id="addUser">Agregar Usuario</button>
          </div>
        </div>

      </div>

      <div class="content" id="conexiones" style="display: none">
        <div class="header-info">
          <button class="connection-btn-fixed online">
            <span>üîò</span> <span class="pressureValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è M</span> <span class="tempValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è L</span> <span class="tempLixValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üíß</span> <span class="phValue">0</span>
          </button>
        </div>
        <h2>Conexiones WIFI</h2>
        <!-- contenido wifi -->
        <div class="panel wifi-table">
          <div class="container5">
            <table id="wifiTable5">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Nombre de Red</th>
                  <th>Intensidad</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Las redes Wi-Fi se agregar√°n aqu√≠ -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="panel wifi-container" id="wifiPasswordContainer5" style="display: none">
          <label id="labelWifiPassword5" for="wifiPassword5"></label>
          <div class="input-container5">
            <input type="password" id="wifiPassword5" required />
            <button class="eye-button5" id="togglePassword5">üëÅÔ∏è</button>
          </div>
          <button id="connectWifi5" class="btn connect-button5" style="display: none">
            Conectar
          </button>
          <button id="disconnectWifi5" class=" btn disconnect-button5" style="display: none">
            Desconectar
          </button>
        </div>
      </div>

      <div class="content" id="ayuda" style="display: none">
        <div class="header-info">
          <button class="connection-btn-fixed online">
            <span>üîò</span> <span class="pressureValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è M</span> <span class="tempValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üå°Ô∏è L</span> <span class="tempLixValue">0</span>
          </button>
          <button class="connection-btn-fixed online">
            <span>üíß</span> <span class="phValue">0</span>
          </button>
        </div>

        <h2>Secci√≥n de ayuda</h2>

        <!-- Seccion de ayuda en forma de elementos de acordeon con 4 contenedores explicando diferentes funcionalidades -->
        <div class="accordion-container">
          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üìò ¬øQu√© es un BioMaster?</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <p>BioMaster es un biorreactor herm√©tico dise√±ado para la fermentaci√≥n controlada de caf√©, ya sea
                despulpado o en cereza. Su funci√≥n principal es permitir la consistencia en la calidad del producto y
                modular el perfil de la taza mediante el monitoreo y control de variables clave del proceso.</p>
              <ul>
                <li>üå°Ô∏è Temperatura (masa y lixiviados)</li>
                <li>üßØ Presi√≥n (m√°ximo 15 PSI)</li>
                <li>üß™ pH</li>
                <li>üíß TDS y Conductividad El√©ctrica</li>
                <li>‚è± Tiempo del proceso</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>‚öôÔ∏è Configuraci√≥n y Calibraci√≥n de Sensores</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <p><strong>üß™ Sensor de pH</strong></p>
              <ol>
                <li>Ve a "Calibraci√≥n" ‚Üí "pH" en la pantalla t√°ctil.</li>
                <li>Coloca el sensor en la soluci√≥n buffer pH 4.01.</li>
                <li>Espera a que la lectura se estabilice y presiona "Calibrar Buffer Bajo".</li>
                <li>Enjuaga con agua destilada y repite con pH 7.01 ‚Üí "Calibrar Buffer Medio".</li>
                <li>Repite con pH 10.01 ‚Üí "Calibrar Buffer Alto".</li>
              </ol>
              <p>üí° No dejes secar el bulbo. Almacena en soluci√≥n HI70300.</p>

              <p><strong>üå°Ô∏è Temperatura de Masa (TM)</strong></p>
              <ol>
                <li>Ve a "Calibraci√≥n" ‚Üí "Temperaturas".</li>
                <li>Inserta un term√≥metro en la masa del tanque fermentador.</li>
                <li>Escribe el valor medido en la casilla "TM" y presiona "Calibrar Temperatura".</li>
              </ol>

              <p><strong>üåä Temperatura de Lixiviado (TL)</strong></p>
              <ol>
                <li>Toma una muestra del lixiviado.</li>
                <li>Mide con un term√≥metro externo.</li>
                <li>Ingresa el valor en la casilla "TL" y presiona "Calibrar Temperatura".</li>
              </ol>

              <p><strong>üßØ Sensor de Presi√≥n</strong></p>
              <ol>
                <li>Aseg√∫rate de que el equipo est√© despresurizado (a presi√≥n ambiente).</li>
                <li>Ve a "Calibraci√≥n" ‚Üí "Presi√≥n".</li>
                <li>Presiona "Calibrar Presi√≥n".</li>
              </ol>
              <p>‚ö† Solo calibra si no hay presi√≥n interna.</p>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üìä Variables que mide el equipo</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <ul>
                <li>üå°Ô∏è Temperatura (de la masa y de los lixiviados)</li>
                <li>üß™ pH</li>
                <li>üßØ Presi√≥n (m√°x. 15 PSI)</li>
                <li>üíß TDS y conductividad el√©ctrica</li>
                <li>‚è± Tiempo de fermentaci√≥n</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üö¶ Modos de Operaci√≥n</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <ul>
                <li><strong>Manual:</strong> Permite el encendido individual de los actuadores como la bomba, el chiller
                  y las v√°lvulas.</li>
                <li><strong>Personalizado:</strong> Permite configurar un valor fijo para cada variable de control.</li>
                <li><strong>Parametrizado:</strong> Permite programar hasta diecis√©is valores diferentes en cada
                  variable de control para crear perfiles complejos.</li>
                <li><strong>Autom√°tico:</strong> Replica curvas de fermentaci√≥n que han sido guardadas previamente.</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üîÅ Ciclo de Recirculaci√≥n</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <ol>
                <li><strong>Drenaje:</strong> los lixiviados se recogen en el tanque de lixiviados.</li>
                <li><strong>Tratamiento:</strong> el l√≠quido pasa por un serpent√≠n para su enfriamiento.</li>
                <li><strong>Bombeo:</strong> se activa una bomba de 1 HP cuando el l√≠quido alcanza el nivel requerido.
                </li>
                <li><strong>Aspersi√≥n:</strong> los lixiviados se roc√≠an nuevamente sobre el caf√© a trav√©s de aspersores
                  en la parte superior del tanque.</li>
              </ol>
              <p>üîÑ Este ciclo se repite autom√°ticamente para asegurar una fermentaci√≥n uniforme.</p>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üì¶ Cuidados del Sensor de pH</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <ul>
                <li>üî¨ Despu√©s de usarlo: sum√©rgelo por un m√≠nimo de 2 horas en soluci√≥n de limpieza HI7061.</li>
                <li>üß™ Almacena en soluci√≥n de almacenamiento HI70300 cuando no est√© en uso por largos periodos.</li>
                <li>‚ö† Nunca lo dejes secar, ya que esto da√±a su vida √∫til.</li>
              </ul>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üì° ¬øC√≥mo conectarme al equipo?</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <p>Los documentos no especifican credenciales de Wi-Fi para el usuario. Mencionan que la conectividad
                remota es un objetivo de desarrollo para que el equipo t√©cnico realice actualizaciones y mantenimiento
                de software a distancia.</p>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <h3>üíæ Exportar datos del proceso</h3>
              <span class="accordion-icon">+</span>
            </div>
            <div class="accordion-content">
              <p>El equipo guarda la informaci√≥n de los procesos en carpetas dentro de un dispositivo de almacenamiento
                (posiblemente una memoria USB o SD, seg√∫n el panel de control):</p>
              <ul>
                <li>üìà <strong>RECETAS:</strong> Contiene las configuraciones y tablas de par√°metros guardadas.</li>
                <li>üßÆ <strong>CURVAS:</strong> Guarda los registros de datos de los procesos de fermentaci√≥n
                  completados.</li>
              </ul>
              <p>Puedes acceder a estos archivos para analizarlos en programas como Excel.</p>
            </div>
          </div>
        </div>


        <!-- Fin boton play pausa stop---------------------------------------------------------- -->
      </div>


    </div>

    <!-- Div contenedor para mostrar el estado de conexi√≥n y el n√∫mero de conectados -->
    <div>
      <div class="connection-status">
        <button id="connection-indicator" class="connection-btn offline">
          <span class="connection-dot"></span>
          <!-- Espacio para mostrar el n√∫mero de conectados -->
          <span class="conected-users">0</span>
          <span class="connection-text">Offline</span>
        </button>
      </div>
    </div>

    <!-- Modal de confirmaci√≥n -->
    <div id="confirmationModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Confirmar acci√≥n</h3>
          <button class="close-btn" onclick="closeModal()">√ó</button>
        </div>
        <div class="modal-body">
          <p>¬øEst√°s seguro de que deseas realizar esta acci√≥n?</p>
        </div>
        <div class="modal-footer">
          <button class="btn cancel-btn" onclick="closeModal()">Cancelar</button>
          <button class="btn accept-btn" onclick="confirmAction()">Aceptar</button>
        </div>
      </div>
    </div>

    <!-- Footer m√≥vil - Solo visible en pantallas peque√±as -->
    <footer id="dashboardFooter" class="dashboard-footer">
      <div class="footer-content">
        <div class="footer-logo">
          <img src="./icons/pyh.png" alt="Penagos y Hermanos Logo" loading="lazy">
        </div>
        <div class="footer-info">
          <div class="company-name">PENAGOS Y HERMANOS</div>
          <div class="machine-name">Biomaster Pro V2 IA</div>
        </div>
      </div>
    </footer>

    <!-- Notificaciones del sistema -->
    <div id="notification" class="notification"></div>

    <!-- Scripts cr√≠ticos que se cargan inmediatamente en orden correcto -->
    <script src="./js/state.js"></script>
    <script defer src="./js/progressManager.js"></script>
    <script defer src="./js/websocket.js"></script>
    <script src="./js/initialization.js"></script>

    <!-- Registro del Service Worker -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
              console.log('BIOMASTER: Service Worker registrado correctamente:', registration.scope);
            })
            .catch((error) => {
              console.log('BIOMASTER: Error al registrar Service Worker:', error);
            });
        });
      }
    </script>

    <!-- Scripts relacionados con gr√°ficas que deben cargarse juntos -->
    <script defer src="./js/chartLibrary.js"></script>
    <script defer src="./js/chart-plugin.min.js"></script>
    <script defer src="./js/chartsLogic.js"></script>

    <!-- Theme despu√©s de que charts est√© listo -->
    <script defer src="./js/theme.js"></script>

    <!-- Scripts no cr√≠ticos que se cargan de forma diferida -->
    <script defer src="./js/buttonLogic.js"></script>
    <script defer src="./js/notification.js"></script>
    <script defer src="./js/calibration.js"></script>
    <script defer src="./js/eventListeners.js"></script>
    <script defer src="./js/telegram.js"></script>
    <script defer src="./js/wifi.js"></script>
</body>

</html>